<!DOCTYPE html>
<html>

<head>
    <title>Elf Comm-Link</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="css/style.css">
    <script src="config.js"></script>
    <script src="js/paho-mqtt-min.js"></script>
    <script src="js/shared.js"></script>
    <script src="js/tts.js"></script>
    <style>
        body {
            background: url('background_ice.jpg') no-repeat center center fixed;
            background-size: cover;
            color: #00e5ff;
            /* theme-ice */
        }

        .numpad-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .display-screen {
            background: rgba(0, 40, 50, 0.8);
            border: 2px solid var(--theme-ice);
            border-radius: 10px;
            padding: 20px;
            width: 280px;
            text-align: center;
            font-family: var(--font-terminal);
            font-size: 2em;
            color: var(--theme-ice);
            text-shadow: 0 0 10px var(--theme-ice);
            min-height: 1.5em;
            margin-bottom: 20px;
            backdrop-filter: blur(5px);
        }

        .keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
        }

        .key {
            width: 70px;
            aspect-ratio: 1;
            background: rgba(0, 229, 255, 0.1);
            border: 2px solid var(--theme-ice);
            border-radius: 50%;
            color: var(--theme-ice);
            font-size: 1.5em;
            font-family: var(--font-title);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
            backdrop-filter: blur(2px);
            justify-self: center;
        }

        .key:active {
            background: var(--theme-ice);
            color: #002233;
            transform: scale(0.95);
            box-shadow: 0 0 20px var(--theme-ice);
        }

        .key.action {
            border-radius: 10px;
            font-size: 1em;
        }

        .key.clear {
            border-color: #f44336;
            color: #f44336;
        }

        .key.clear:active {
            background: #f44336;
            color: white;
        }

        .key.enter {
            border-color: #4caf50;
            color: #4caf50;
        }

        .key.enter:active {
            background: #4caf50;
            color: white;
        }

        .shake {
            animation: shake 0.5s;
        }

        @keyframes shake {
            0% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-10px);
            }

            50% {
                transform: translateX(10px);
            }

            75% {
                transform: translateX(-10px);
            }

            100% {
                transform: translateX(0);
            }
        }
    </style>
</head>

<body class="theme-kristine" data-snow="true">
    <div class="music-toggle" id="musicToggle">ðŸŽ¶</div>
    <audio id="bgm" loop>
        <source src="Jingle Joyride.mp3" type="audio/mpeg">
    </audio>

    <!-- SCREEN 0: BOOT -->
    <div id="screen-boot" class="screen active">
        <h1 style="font-size: 3em; color: var(--theme-ice); text-shadow: 0 0 20px var(--theme-ice);">SIGNAL LOST</h1>
        <p class="mono">ENTER RECOVERY CODE</p>
        <button onclick="startApp()">ACQUIRE SIGNAL</button>
    </div>

    <!-- MAIN UI -->
    <div id="screen-app" class="screen">
        <div class="glass-panel">
            <div class="hud-bar">
                <span>UPLINK STATUS</span>
                <span>KRISTINE</span>
            </div>

            <div class="primary-panel">
                <div class="numpad-container">
                    <div class="display-screen" id="display">_ _ _ _</div>
                    <div class="keypad">
                        <div class="key" onclick="press(1)">1</div>
                        <div class="key" onclick="press(2)">2</div>
                        <div class="key" onclick="press(3)">3</div>
                        <div class="key" onclick="press(4)">4</div>
                        <div class="key" onclick="press(5)">5</div>
                        <div class="key" onclick="press(6)">6</div>
                        <div class="key" onclick="press(7)">7</div>
                        <div class="key" onclick="press(8)">8</div>
                        <div class="key" onclick="press(9)">9</div>
                        <div class="key action clear" onclick="clearInput()">CLR</div>
                        <div class="key" onclick="press(0)">0</div>
                        <div class="key action enter" onclick="submit()">ENT</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- OUTRO -->
    <div id="screen-outro" class="screen">
        <div class="glass-panel" style="text-align: center;">
            <h1 style="color: var(--success); font-size: 3em;">SIGNAL RESTORED</h1>
            <p class="mono">ENCRYPTION BYPASSED</p>
            <div style="font-size: 5em; margin: 20px; color: var(--theme-ice);">ðŸ“¡</div>
        </div>
    </div>

    <script>
        // CONFIGURATION
        const SECRET_CODE = "12345"; // TODO: Update this with the real code if different

        let currentInput = "";

        AudioManager.init('bgm');

        function startApp() {
            document.getElementById('screen-boot').classList.remove('active');
            document.getElementById('screen-app').classList.add('active');
            updateDisplay();
        }

        function press(num) {
            if (currentInput.length < 5) {
                currentInput += num;
                updateDisplay();
            }
        }

        function clearInput() {
            currentInput = "";
            updateDisplay();
        }

        function updateDisplay() {
            const disp = document.getElementById('display');
            let text = currentInput;
            for (let i = 0; i < (5 - currentInput.length); i++) {
                text += " _";
            }
            disp.innerText = text;
            disp.classList.remove('shake');
        }

        function submit() {
            if (currentInput === SECRET_CODE) {
                // Success
                document.getElementById('display').style.color = 'var(--success)';
                document.getElementById('display').style.borderColor = 'var(--success)';
                setTimeout(() => {
                    Network.sendSolve('kristine');
                    document.getElementById('screen-app').classList.remove('active');
                    document.getElementById('screen-outro').classList.add('active');
                }, 500);
            } else {
                // Fail
                const disp = document.getElementById('display');
                disp.style.borderColor = 'red';
                disp.style.color = 'red';
                disp.classList.add('shake');
                setTimeout(() => {
                    currentInput = "";
                    disp.style.borderColor = 'var(--theme-ice)';
                    disp.style.color = 'var(--theme-ice)';
                    updateDisplay();
                }, 800);
            }
        }
    </script>
</body>

</html>